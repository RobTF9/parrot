import React, { createRef, useEffect } from 'react';
import { motion } from 'framer-motion';
import { ParrotWrapper } from './styles';

interface Props {
  speaking?: boolean;
  onSpeakingEnd?: () => void;
  phrase?: string;
  language?: string;
  langCode?: string;
}

const Parrot: React.FC<Props> = ({
  language,
  speaking,
  onSpeakingEnd,
  phrase,
  langCode,
}) => {
  const [duration, bodyRotation, beakBounce, repeat, repeatType]: [
    number,
    number,
    number,
    number,
    'reverse'
  ] = [
    speaking ? 0.9 : 0,
    speaking ? 2 : 0,
    speaking ? 4 : 0,
    Infinity,
    'reverse',
  ];

  const audioEl = createRef<HTMLAudioElement>();

  const play = () => {
    if (audioEl.current) {
      audioEl.current.play();
    }
  };

  useEffect(() => {
    if (speaking && phrase) {
      play();
    }
  }, [speaking, phrase]);

  return (
    <>
      {phrase && langCode && onSpeakingEnd && (
        <audio
          onEnded={() => onSpeakingEnd()}
          ref={audioEl}
          src={`https://translate.google.com/translate_tts?ie=UTF-8&tl=${langCode}&client=tw-ob&q=${phrase}`}
        />
      )}
      <ParrotWrapper duration={duration} language={language}>
        <svg
          viewBox="0 0 147 173"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <motion.g
            {...{
              animate: {
                rotate: bodyRotation,
              },
              transition: {
                repeat,
                repeatType,
                duration,
              },
            }}
          >
            <path
              className="body"
              d="M97.5791 172.018C97.2216 172.018 96.863 171.974 96.5045 171.89C94.417 171.364 93.0009 169.419 93.1517 167.267L97.3449 108.623L87.3037 105.278C85.633 104.721 84.451 103.226 84.2877 101.469L80.3537 58.1552C79.2699 58.3504 78.0937 58.4749 76.8741 58.4749C72.4284 58.4749 62.0959 56.5773 62.0959 38.9893C62.0959 33.4829 67.8914 27.9421 75.9423 27.9421C83.9874 27.9421 93.2385 33.9315 104.221 46.2414C114.092 57.3126 119.756 74.0638 119.756 92.1987C119.756 128.124 102.372 167.714 101.634 169.379C100.909 171.014 99.2989 172.018 97.5791 172.018Z"
            />
            <path
              className="shadow"
              d="M104.217 46.2437C93.2362 33.9338 83.984 27.9456 75.9389 27.9456C75.2525 27.9456 74.5902 27.9992 73.9404 28.0734C81.5185 28.9617 90.1506 34.9237 100.25 46.2437C110.12 57.3149 115.785 74.066 115.785 92.2009C115.785 128.126 98.4002 167.716 97.6624 169.382C97.2331 170.354 96.4896 171.092 95.5943 171.542C95.8798 171.686 96.1802 171.81 96.4999 171.893C96.8585 171.978 97.2205 172.021 97.5722 172.021C99.2966 172.021 100.904 171.018 101.627 169.382C102.366 167.716 119.749 128.126 119.749 92.2009C119.754 74.066 114.088 57.3149 104.217 46.2437Z"
            />
            <path
              className="outer"
              d="M114.116 132.343C117.256 119.944 119.754 105.811 119.754 92.2009C119.754 74.066 114.088 57.3149 104.218 46.2437C100.469 42.0411 96.9281 38.5943 93.5616 35.8496L90.13 44.7858C94.2046 44.5643 101.479 54.7449 96.8505 61.2218C88.9196 62.0804 86.6036 73.8674 90.13 80.8067C93.653 87.746 116.016 103.164 114.116 132.343Z"
            />
            <path
              className="shadow"
              d="M101.126 42.9099C100.377 42.1302 99.6347 41.3766 98.9027 40.6596C98.8307 40.5854 98.7531 40.5089 98.6811 40.4347C96.9351 38.7381 95.2324 37.2162 93.5765 35.8645C93.5708 35.8599 93.5663 35.8553 93.5606 35.8496L92.5728 38.4207C95.0371 40.6619 97.5928 43.2604 100.254 46.2437C110.124 57.3149 115.789 74.066 115.789 92.2009C115.789 100.977 114.747 109.968 113.17 118.573C114.049 122.784 114.443 127.358 114.118 132.346C114.489 130.881 114.851 129.389 115.198 127.88C115.243 127.683 115.288 127.483 115.334 127.286C115.671 125.812 115.999 124.324 116.31 122.819C116.314 122.792 116.323 122.766 116.328 122.741C116.637 121.239 116.926 119.718 117.207 118.186C117.26 117.899 117.31 117.605 117.363 117.315C117.624 115.848 117.867 114.371 118.093 112.883C118.105 112.818 118.115 112.756 118.123 112.69C118.348 111.175 118.549 109.647 118.734 108.12C118.775 107.772 118.815 107.426 118.855 107.077C119.022 105.597 119.176 104.11 119.302 102.628C119.308 102.565 119.316 102.508 119.322 102.443C119.444 100.927 119.537 99.4085 119.61 97.8924C119.628 97.5236 119.642 97.1537 119.657 96.7815C119.717 95.2516 119.759 93.724 119.759 92.2055C119.759 74.0706 114.094 57.3194 104.224 46.2483C103.367 45.287 102.524 44.3782 101.687 43.4956C101.493 43.2947 101.31 43.104 101.126 42.9099Z"
            />
            <path
              className="outer"
              d="M93.5594 35.8496C87.0639 30.5578 81.2387 27.9421 75.9388 27.9421C67.8891 27.9421 62.0925 33.4829 62.0925 38.9893C62.0925 39.1788 62.1005 39.3524 62.104 39.5385C68.5869 35.9832 79.8832 32.0489 93.5594 35.8496Z"
            />
            <path
              className="shadow"
              d="M73.9518 28.0723C73.9495 28.0735 73.9449 28.0735 73.9426 28.0735C78.3084 28.5861 83.0281 30.7919 88.1704 34.7251C89.9187 34.9763 91.715 35.337 93.5593 35.8497C91.1532 33.8882 88.8373 32.3012 86.6081 31.0693C86.5442 31.0351 86.4825 31.0008 86.4186 30.9666C85.7505 30.6047 85.0905 30.277 84.4373 29.979C84.3699 29.9482 84.3037 29.9139 84.234 29.8842C82.8579 29.2711 81.5173 28.8122 80.2086 28.4891C80.0441 28.4491 79.8854 28.416 79.721 28.3806C79.2368 28.2721 78.7583 28.1888 78.2832 28.1214C78.1108 28.0975 77.9349 28.0689 77.7659 28.0507C77.1504 27.981 76.5429 27.9376 75.9388 27.9376C75.5505 27.9376 75.1737 27.9616 74.7968 27.9867C74.5136 28.0141 74.2315 28.0415 73.9518 28.0723Z"
            />
            <path
              className="eye"
              d="M77.1917 44.7732C76.1617 44.7732 75.127 44.3325 74.3745 43.6167C73.6585 42.8586 73.2234 41.8208 73.2234 40.783C73.2234 39.7463 73.6585 38.7131 74.3745 37.9515C75.8442 36.4753 78.5381 36.4753 80.0066 37.9515C80.7204 38.7131 81.1589 39.7463 81.1589 40.783C81.1589 41.8208 80.7204 42.8586 80.0066 43.6167C79.253 44.3325 78.2206 44.7732 77.1917 44.7732Z"
            />
            <path
              className="pupil"
              d="M77.1918 43.4512C76.5031 43.4512 75.8157 43.1601 75.3121 42.6805C74.8347 42.1748 74.5447 41.4829 74.5447 40.791C74.5447 40.1014 74.8347 39.4095 75.3121 38.9038C76.2907 37.9196 78.0871 37.9196 79.0657 38.9038C79.5408 39.4095 79.8331 40.1026 79.8331 40.791C79.8331 41.4829 79.5408 42.1748 79.0657 42.6805C78.5667 43.1601 77.8804 43.4512 77.1918 43.4512Z"
            />
            <motion.path
              className="beak"
              {...{
                animate: {
                  rotate: beakBounce,
                },
                transition: {
                  repeat: Infinity,
                  repeatType: 'reverse',
                  duration: duration / 2,
                },
              }}
              d="M93.5595 35.8485C87.523 51.7137 80.1562 53.5987 70.8458 50.6793C61.2042 47.6584 63.0553 35.1806 65.3632 31.9895C65.3769 31.9793 65.3872 31.9656 65.3998 31.953C63.1387 33.0205 60.2507 34.6771 57.2439 37.19C54.1868 39.7349 52.4077 43.0949 52.0948 46.906C51.405 55.2975 56.6009 63.9129 62.0915 65.5946C65.8189 65.3788 67.1904 58.5377 67.9201 56.1698C71.0308 58.7443 74.4396 58.9681 76.6298 58.9681C77.8483 58.9681 79.31 58.8049 80.3892 58.6108C86.1196 54.7164 89.9874 51.3974 93.5595 35.8485Z"
            />
          </motion.g>
          <path
            className="perch"
            d="M4.44053 134.127C2.84635 134.127 1.30812 133.271 0.513318 131.765C-0.63093 129.6 0.202704 126.916 2.36901 125.773C4.88704 124.446 64.8401 93.4432 138.335 107.602C140.737 108.068 142.309 110.39 141.851 112.8C141.384 115.198 139.067 116.772 136.653 116.315C66.2014 102.741 7.0956 133.306 6.50635 133.615C5.84857 133.964 5.13827 134.127 4.44053 134.127Z"
          />
        </svg>
      </ParrotWrapper>
    </>
  );
};

export default Parrot;
